# Kube State Metrics - Monitoring Stack Example
# Kubernetes object state metrics

replicaCount: 1

image:
  repository: registry.k8s.io/kube-state-metrics/kube-state-metrics
  pullPolicy: IfNotPresent
  tag: "v2.13.0"

kubeStateMetrics:
  # Collectors - all enabled by default
  collectors:
    - certificatesigningrequests
    - configmaps
    - cronjobs
    - daemonsets
    - deployments
    - endpoints
    - horizontalpodautoscalers
    - ingresses
    - jobs
    - leases
    - limitranges
    - mutatingwebhookconfigurations
    - namespaces
    - networkpolicies
    - nodes
    - persistentvolumeclaims
    - persistentvolumes
    - poddisruptionbudgets
    - pods
    - replicasets
    - replicationcontrollers
    - resourcequotas
    - secrets
    - services
    - statefulsets
    - storageclasses
    - validatingwebhookconfigurations
    - volumeattachments

  # Metric labels allowlist
  extraArgs:
    - --metric-labels-allowlist=pods=[*],deployments=[app,version,component],services=[app,type],nodes=[node-role.kubernetes.io/master,node-role.kubernetes.io/worker]

# Resources
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Service
service:
  type: ClusterIP
  port: 8080

# ServiceMonitor
serviceMonitor:
  enabled: true
  interval: 30s

# Security
serviceAccount:
  create: true

podSecurityContext:
  fsGroup: 65534
  runAsUser: 65534
  runAsNonRoot: true

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false

# RBAC - needs ClusterRole to read all K8s resources
rbac:
  create: true
  clusterRole:
    create: true

# Health probes
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
