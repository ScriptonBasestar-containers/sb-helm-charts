# Default values for rsshub.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# 1. Application-specific Configuration Block
rsshub:
  # Node environment (production or development)
  nodeEnv: "production"

  # Cache settings
  cache:
    # Cache type: memory or redis
    type: "memory"
    # Cache expire time (seconds)
    expire: 300
    # Content expire time (seconds)
    contentExpire: 3600

  # Redis configuration (when cache.type is redis)
  redis:
    url: ""  # e.g., redis://redis-service:6379/
    # Or use separate fields:
    host: ""
    port: 6379
    password: ""
    db: 0

  # Request settings
  request:
    # User agent
    userAgent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36"
    # Timeout (milliseconds)
    timeout: 30000
    # Retry times
    retry: 3

  # Access control
  accessKey: ""  # Access key for authentication (optional)

  # Puppeteer settings (for dynamic rendering)
  puppeteer:
    # WebSocket endpoint for browserless/chrome
    wsEndpoint: ""
    # e.g., ws://browserless-chrome:3000

  # Feature flags
  features:
    # Enable/disable specific routes (optional)
    enabledRoutes: []
    # Disallowed routes
    disallowedRoutes: []

  # Logging
  logLevel: "info"  # error, warn, info, verbose, debug

# 2. External Dependencies (ALWAYS disabled)
postgresql:
  enabled: false

mysql:
  enabled: false

redis:
  enabled: false

# 3. Persistence Configuration (optional for cache)
persistence:
  enabled: false
  storageClass: ""
  size: 1Gi
  accessMode: ReadWriteOnce
  existingClaim: ""
  mountPath: /app/cache

# 4. Kubernetes Resources - Standard Section
replicaCount: 1

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

image:
  repository: diygod/rsshub
  tag: "2025-11-09"
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# 5. Service Account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# 6. Pod Configuration
podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000
  runAsNonRoot: true

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false  # RSSHub needs to write temp files
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false

# 7. Service Configuration
service:
  type: ClusterIP
  port: 1200
  targetPort: 1200
  protocol: TCP
  annotations: {}

# 8. Ingress Configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: rsshub.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: rsshub-tls
  #    hosts:
  #      - rsshub.local

# 9. Resources
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 256Mi

# 10. Health Probes
livenessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

readinessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30
  successThreshold: 1

# 11. Autoscaling
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# 12. Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# 13. Network Policy
networkPolicy:
  enabled: false
  ingress:
    - from:
        - podSelector: {}
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 1200
  egress:
    # Allow DNS resolution
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: UDP
          port: 53
    # Allow HTTP/HTTPS for RSS feed fetching
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 443
    # Allow Redis connection (if using external Redis)
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 6379

# 14. Monitoring
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    path: /

# 15. Scheduling
nodeSelector: {}
tolerations: []
affinity: {}
priorityClassName: ""
topologySpreadConstraints: []

# 16. Extensibility
extraEnv: []
# Example:
# extraEnv:
#   - name: ALLOW_LOCALHOST
#     value: "true"

extraEnvFrom: []

extraVolumes: []
# Example:
# extraVolumes:
#   - name: custom-config
#     configMap:
#       name: rsshub-config

extraVolumeMounts: []
# Example:
# extraVolumeMounts:
#   - name: custom-config
#     mountPath: /app/config
#     readOnly: true

initContainers: []
# Example: Wait for Redis
# initContainers:
#   - name: wait-for-redis
#     image: redis:7-alpine
#     command: ['sh', '-c', 'until redis-cli -h $REDIS_HOST ping; do sleep 2; done']

lifecycle: {}
# Example:
# lifecycle:
#   preStop:
#     exec:
#       command: ["/bin/sh", "-c", "sleep 15"]
