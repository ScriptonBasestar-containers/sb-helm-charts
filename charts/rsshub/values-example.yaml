# Example values file for RSSHub production deployment
# Copy this file to my-values.yaml and customize for your environment

# Replica configuration
replicaCount: 2

# Container image
image:
  repository: diygod/rsshub
  pullPolicy: IfNotPresent
  tag: "latest"  # Or specify a specific version

# Service configuration
service:
  type: ClusterIP
  appPort: 1200

# Ingress configuration
ingress:
  enabled: true
  className: "nginx"

  annotations:
    # SSL/TLS configuration (if using cert-manager)
    cert-manager.io/cluster-issuer: "letsencrypt-prod"

    # Rate limiting (optional)
    nginx.ingress.kubernetes.io/limit-rps: "100"

    # Optional: Force HTTPS redirect
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"

  hosts:
    - host: rss.example.com
      paths:
        - path: /
          pathType: Prefix

  # TLS configuration
  tls:
    - secretName: rsshub-tls
      hosts:
        - rss.example.com

# Resource limits and requests
resources:
  limits:
    cpu: 1000m      # 1 CPU core
    memory: 1Gi     # 1 GB RAM
  requests:
    cpu: 250m       # 0.25 CPU cores
    memory: 256Mi   # 256 MB RAM

# Health check configuration
livenessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 30

# Autoscaling (optional)
# Enable for automatic scaling based on CPU/memory usage
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget
# Ensures minimum availability during voluntary disruptions (node drains, updates)
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # Alternative: maxUnavailable: 1

# Network Policy
# Restricts network access to RSSHub pods
networkPolicy:
  enabled: true
  ingress:
    # Allow traffic from ingress controller
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
      ports:
        - protocol: TCP
          port: 1200
    # Allow traffic from other RSSHub pods (for multi-replica setups)
    - from:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: rsshub
      ports:
        - protocol: TCP
          port: 1200
  egress:
    # Allow DNS resolution
    - to:
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: UDP
          port: 53
    # Allow external HTTP/HTTPS (for fetching RSS feeds)
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 443

# Monitoring configuration
# ServiceMonitor for Prometheus Operator
monitoring:
  serviceMonitor:
    enabled: true
    path: /
    interval: 30s
    scrapeTimeout: 10s
    additionalLabels:
      prometheus: kube-prometheus
    # Relabeling configurations (optional)
    relabelings: []
    # Target labels (optional)
    targetLabels: []

# Security context (optional)
# podSecurityContext:
#   fsGroup: 1000

# securityContext:
#   runAsUser: 1000
#   runAsGroup: 1000
#   runAsNonRoot: true
#   readOnlyRootFilesystem: true

# Node selector (optional)
# nodeSelector:
#   disktype: ssd
#   node-role: worker

# Tolerations (optional)
# tolerations:
#   - key: "node-role"
#     operator: "Equal"
#     value: "worker"
#     effect: "NoSchedule"

# Affinity rules (optional)
# Spread pods across different nodes for high availability
# affinity:
#   podAntiAffinity:
#     preferredDuringSchedulingIgnoredDuringExecution:
#       - weight: 100
#         podAffinityTerm:
#           labelSelector:
#             matchExpressions:
#               - key: app.kubernetes.io/name
#                 operator: In
#                 values:
#                   - rsshub
#           topologyKey: kubernetes.io/hostname

# Additional environment variables (optional)
# Configure RSSHub specific settings
# extraEnv:
#   - name: CACHE_TYPE
#     value: "redis"
#   - name: REDIS_URL
#     value: "redis://redis-service:6379/"
#   - name: PUPPETEER_WS_ENDPOINT
#     value: "ws://browserless:3000"
#   - name: ALLOW_ORIGIN
#     value: "*"
#   - name: REQUEST_TIMEOUT
#     value: "30000"

# Additional volumes (optional)
# volumes:
#   - name: cache
#     emptyDir: {}

# Additional volume mounts (optional)
# volumeMounts:
#   - name: cache
#     mountPath: /app/cache
