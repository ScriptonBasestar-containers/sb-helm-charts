# Default values for browserless-chrome.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# 1. Application-specific Configuration Block
browserless:
  # Concurrent browser sessions (default: 10)
  concurrent: 10

  # API token for authentication
  # Generate with: openssl rand -hex 16
  token: ""

  # Use existing secret for token
  existingSecret: ""
  secretKeyName: "browserless-token"

  # Connection timeout (milliseconds)
  connectionTimeout: 60000

  # Maximum queue length
  maxQueueLength: 10

  # Chrome launch arguments (optional)
  chromeArgs: []
  # Example:
  # chromeArgs:
  #   - "--disable-dev-shm-usage"
  #   - "--no-sandbox"

  # Debug mode
  debug: false

  # Enable demo mode (allows UI access without token)
  demoMode: false

# 2. External Dependencies (ALWAYS disabled)
postgresql:
  enabled: false

mysql:
  enabled: false

redis:
  enabled: false

# 3. Persistence Configuration (optional for downloads/temp files)
persistence:
  enabled: false
  storageClass: ""
  size: 2Gi
  accessMode: ReadWriteOnce
  existingClaim: ""
  mountPath: /tmp/browserless

# 4. Kubernetes Resources - Standard Section
replicaCount: 1

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

image:
  repository: ghcr.io/browserless/chrome
  tag: "1.61.1-puppeteer-21.4.1"
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# 5. Service Account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# 6. Pod Configuration
podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000
  runAsGroup: 1000
  runAsNonRoot: true

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false  # Chrome needs to write temp files
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  allowPrivilegeEscalation: false

# 7. Service Configuration
service:
  type: ClusterIP
  port: 3000
  targetPort: 3000
  protocol: TCP
  annotations: {}

# 8. Ingress Configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  # annotations 예시:
  #   kubernetes.io/ingress.class: nginx
  #   kubernetes.io/tls-acme: "true"
  hosts:
    - host: browserless.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: browserless-tls
  #    hosts:
  #      - browserless.local

# 9. Resources
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

# 10. Health Probes
livenessProbe:
  enabled: true
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

readinessProbe:
  enabled: true
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  enabled: true
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# 11. Autoscaling
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# 12. Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# 13. Network Policy
networkPolicy:
  enabled: false
  ingress:
    - from:
        - podSelector: {}
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 3000
  egress:
    # Allow DNS resolution
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: UDP
          port: 53
    # Allow HTTPS for Chrome downloads
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 443

# 14. Monitoring
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    path: /metrics

# 15. Scheduling
nodeSelector: {}
tolerations: []
affinity: {}
priorityClassName: ""
topologySpreadConstraints: []

# 16. Extensibility
extraEnv: []
# Example:
# extraEnv:
#   - name: CHROME_REFRESH_TIME
#     value: "60000"

extraEnvFrom: []

extraVolumes: []
# Example:
# extraVolumes:
#   - name: fonts
#     configMap:
#       name: custom-fonts

extraVolumeMounts: []
# Example:
# extraVolumeMounts:
#   - name: fonts
#     mountPath: /usr/share/fonts/custom
#     readOnly: true

initContainers: []
# Example: Font installation
# initContainers:
#   - name: install-fonts
#     image: alpine:3.18
#     command: ['sh', '-c', 'apk add --no-cache fontconfig']

lifecycle: {}
# Example:
# lifecycle:
#   preStop:
#     exec:
#       command: ["/bin/sh", "-c", "sleep 15"]
