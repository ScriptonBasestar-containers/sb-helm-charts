# Home Server / NAS optimized configuration for RustFS
# Suitable for: Raspberry Pi 4, Intel NUC, Synology NAS, QNAP, low-power servers
#
# Key features:
# - Reduced resource usage (500m CPU, 1Gi RAM)
# - HDD storage optimization
# - Single replica (no HA overhead)
# - Minimal monitoring overhead
# - Internal network only
#
# Usage:
#   helm install rustfs ./charts/rustfs -f charts/rustfs/values-homeserver.yaml

# RustFS configuration
rustfs:
  # CHANGE THESE IN PRODUCTION!
  rootUser: "admin"
  rootPassword: "changeme-admin-password"

  region: "home-nas"
  consolePort: 9001
  apiPort: 9000

  # Reduced data directories for home server (2 dirs = ~200Gi total with default size)
  dataDirs: 2

  extraEnv: []
  args: []

# Persistence - HDD optimized for NAS
persistence:
  enabled: true

  # Use HDD storage class (adjust to your environment)
  # Examples: "local-path", "nfs-client", "hdd-storage", "longhorn"
  storageClass: ""  # Empty = default storage class

  accessMode: ReadWriteOnce

  # 100Gi per directory (total: 200Gi for 2 dirs)
  size: 100Gi

  # Retain PVCs after deletion (important for data safety on home server)
  reclaimPolicy: Retain

  existingClaim: ""
  annotations: {}

# Storage tiers disabled (single tier HDD for simplicity)
storageTiers:
  enabled: false

# Single replica (no HA needed for home server)
replicaCount: 1

# Container image
image:
  repository: rustfs/rustfs
  pullPolicy: IfNotPresent
  tag: "1.0.0-alpha.66"

imagePullSecrets: []

nameOverride: ""
fullnameOverride: ""

# Service account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

# Security context
podSecurityContext:
  fsGroup: 1000
  fsGroupChangePolicy: "OnRootMismatch"

securityContext:
  runAsUser: 1000
  runAsGroup: 1000
  runAsNonRoot: true
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# Service - ClusterIP for internal access only
service:
  type: ClusterIP  # Use NodePort or LoadBalancer if external access needed

  api:
    port: 9000
    targetPort: 9000
    nodePort: null  # Set to 30900 for NodePort access

  console:
    port: 9001
    targetPort: 9001
    nodePort: null  # Set to 30901 for NodePort access

  annotations: {}

# Headless service for StatefulSet
headlessService:
  enabled: true

# Ingress disabled (use port-forward for home network)
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
  api:
    enabled: false
    hosts: []
    tls: []
  console:
    enabled: false
    hosts: []
    tls: []

# Resource limits - Home server optimized
# Suitable for: Intel Celeron, ARM Cortex-A72, 4GB+ RAM systems
resources:
  limits:
    cpu: 1000m      # 1 CPU core max
    memory: 2Gi     # 2GB RAM max
  requests:
    cpu: 250m       # 0.25 CPU core baseline
    memory: 512Mi   # 512MB RAM baseline

# Health probes - More lenient timings for slow HDD
livenessProbe:
  httpGet:
    path: /rustfs/health/live
    port: api
  initialDelaySeconds: 90   # Longer startup time for HDD
  periodSeconds: 60         # Check every minute
  timeoutSeconds: 10
  failureThreshold: 5
  successThreshold: 1

readinessProbe:
  httpGet:
    path: /rustfs/health/ready
    port: api
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 5
  successThreshold: 1

startupProbe:
  httpGet:
    path: /rustfs/health/live
    port: api
  initialDelaySeconds: 0
  periodSeconds: 15
  timeoutSeconds: 10
  failureThreshold: 40      # Allow up to 10 minutes for HDD initialization
  successThreshold: 1

# Autoscaling disabled (single node home server)
autoscaling:
  enabled: false

# PodDisruptionBudget disabled (single replica)
podDisruptionBudget:
  enabled: false

# NetworkPolicy disabled (trusted home network)
networkPolicy:
  enabled: false

# Monitoring disabled (reduce overhead on low-power devices)
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false

# Node selector - Optional: pin to specific node
nodeSelector: {}
# Example: Pin to NAS node
# nodeSelector:
#   kubernetes.io/hostname: synology-nas

# Tolerations - Optional: allow scheduling on tainted nodes
tolerations: []
# Example: Allow scheduling on ARM nodes
# tolerations:
#   - key: "arm"
#     operator: "Exists"
#     effect: "NoSchedule"

# Affinity rules disabled (single node)
affinity: {}

extraEnvFrom: []
extraVolumes: []
extraVolumeMounts: []

# Init container - Fix permissions for NAS/NFS storage
initContainers:
  - name: fix-permissions
    image: busybox:1.36
    command: ['sh', '-c', 'chown -R 1000:1000 /data && chmod -R 755 /data']
    volumeMounts:
      - name: data-0
        mountPath: /data/rustfs0
      - name: data-1
        mountPath: /data/rustfs1
    securityContext:
      runAsUser: 0

lifecycle: {}

# Update strategy - RollingUpdate for graceful updates
updateStrategy:
  type: RollingUpdate
  rollingUpdate:
    partition: 0

# Parallel pod management for faster startup
podManagementPolicy: Parallel
