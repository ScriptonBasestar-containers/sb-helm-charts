# Default values for nextcloud.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Nextcloud application configuration
nextcloud:
  # Admin user configuration (will be created on first installation)
  adminUser: admin
  # Admin password (required for first setup)
  adminPassword: ""

  # Nextcloud version/edition
  version: "28.0"  # Nextcloud version

  # Trusted domains (required for external access)
  trustedDomains: []
  # Example:
  # - nextcloud.example.com

  # SMTP configuration (optional)
  smtp:
    enabled: false
    host: ""
    port: 587
    secure: "tls"
    authType: "LOGIN"
    from: ""
    username: ""
    password: ""

# External PostgreSQL 16 configuration
postgresql:
  enabled: false  # We use external PostgreSQL
  external:
    enabled: true
    host: ""  # e.g., postgres-service.default.svc.cluster.local
    port: 5432
    database: "nextcloud"
    username: "nextcloud"
    password: ""
    # Use existing secret (optional)
    existingSecret:
      enabled: false
      secretName: ""
      usernameKey: "username"
      passwordKey: "password"

# External Redis 8 configuration
redis:
  enabled: false  # We use external Redis
  external:
    enabled: true
    host: ""  # e.g., redis-service.default.svc.cluster.local
    port: 6379
    password: ""
    database: 0
    # Use existing secret (optional)
    existingSecret:
      enabled: false
      secretName: ""
      passwordKey: "password"

# Persistent storage configuration
persistence:
  enabled: true
  # Storage for Nextcloud data
  data:
    enabled: true
    storageClass: ""  # Use default storage class if empty
    accessMode: ReadWriteOnce
    size: 8Gi
    # Use existing PVC (optional)
    existingClaim: ""
  # Storage for Nextcloud config
  config:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
    existingClaim: ""
  # Storage for custom apps
  apps:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
    existingClaim: ""

# Replica count
replicaCount: 1

# Container image configuration
image:
  repository: nextcloud
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: "28.0-apache"

# Image pull secrets for private registries
imagePullSecrets: []

# Override chart name
nameOverride: ""
fullnameOverride: ""

# Service account configuration
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# Pod security context
podSecurityContext:
  fsGroup: 33  # www-data group for Nextcloud

# Container security context
securityContext:
  runAsUser: 33  # www-data user for Nextcloud
  runAsGroup: 33
  runAsNonRoot: true
  readOnlyRootFilesystem: false

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 80

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "10G"
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    nginx.ingress.kubernetes.io/server-snippet: |
      client_max_body_size 10G;
      location = /.well-known/carddav {
        return 301 $scheme://$host/remote.php/dav;
      }
      location = /.well-known/caldav {
        return 301 $scheme://$host/remote.php/dav;
      }
  hosts:
    - host: nextcloud.example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  # Example TLS configuration:
  # tls:
  #   - secretName: nextcloud-tls
  #     hosts:
  #       - nextcloud.example.com

# Resource limits and requests
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

# Liveness probe configuration
livenessProbe:
  httpGet:
    path: /status.php
    port: http
    httpHeaders:
      - name: Host
        value: "localhost"
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

# Readiness probe configuration
readinessProbe:
  httpGet:
    path: /status.php
    port: http
    httpHeaders:
      - name: Host
        value: "localhost"
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Startup probe (for slow initialization)
startupProbe:
  httpGet:
    path: /status.php
    port: http
    httpHeaders:
      - name: Host
        value: "localhost"
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# Autoscaling configuration (disabled by default for stateful app)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Additional environment variables
extraEnv: []
# Example:
# - name: CUSTOM_VAR
#   value: "custom-value"

# Additional volumes
extraVolumes: []
# Example:
# - name: custom-config
#   configMap:
#     name: custom-configmap

# Additional volume mounts
extraVolumeMounts: []
# Example:
# - name: custom-config
#   mountPath: /etc/custom

# Nextcloud cron job configuration
cronjob:
  enabled: true
  schedule: "*/15 * * * *"
  # Resource limits for cron job
  resources:
    limits:
      cpu: 100m
      memory: 256Mi
    requests:
      cpu: 50m
      memory: 128Mi
