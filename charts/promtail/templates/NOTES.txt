Thank you for installing {{ .Chart.Name }}!

Your Promtail DaemonSet is ready to collect logs.

1. Configuration:

  - Loki URL: {{ .Values.promtail.client.url }}
  - Nodes with Promtail: Run 'kubectl get ds -n {{ .Release.Namespace }} {{ include "promtail.fullname" . }}'

2. Check Promtail status:

  kubectl get pods -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "promtail.name" . }}

3. View Promtail logs:

  kubectl logs -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "promtail.name" . }} --tail=100 -f

4. Verify log collection:

  kubectl logs -n {{ .Release.Namespace }} $(kubectl get pod -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "promtail.name" . }} -o jsonpath="{.items[0].metadata.name}") | grep "Starting Promtail"

5. Check Promtail targets:

  # Port-forward to a Promtail pod
  kubectl port-forward -n {{ .Release.Namespace }} $(kubectl get pod -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "promtail.name" . }} -o jsonpath="{.items[0].metadata.name}") 3101:{{ .Values.promtail.server.httpListenPort }}

  # Access targets endpoint
  curl http://localhost:3101/targets

6. Pipeline stages:

{{- if .Values.promtail.pipelineStages.cri.enabled }}
  - CRI parser: Enabled (for containerd/cri-o)
{{- end }}
{{- if .Values.promtail.pipelineStages.docker.enabled }}
  - Docker parser: Enabled
{{- end }}
  - Log level extraction: Enabled

7. Verify logs in Loki:

  Query Loki to see if logs are being received:

  # Using LogQL
  {namespace="{{ .Release.Namespace }}"}

  # Check all namespaces
  {namespace=~".+"}

{{- if .Values.promtail.kubernetesSD.addPodAnnotations }}

8. Pod annotations as labels:

  Pod annotations are being added as Loki labels.
  This may increase label cardinality significantly.

{{- end }}

9. Kubernetes labels added to logs:

  - namespace: Kubernetes namespace
  - pod: Pod name
  - container: Container name
  - node: Node name
  - All pod labels (prefixed with label_)

10. Troubleshooting:

  # Check if Promtail can reach Loki
  kubectl exec -n {{ .Release.Namespace }} $(kubectl get pod -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "promtail.name" . }} -o jsonpath="{.items[0].metadata.name}") -- wget -O- {{ .Values.promtail.client.url | replace "/loki/api/v1/push" "/ready" }}

  # View Promtail configuration
  kubectl exec -n {{ .Release.Namespace }} $(kubectl get pod -n {{ .Release.Namespace }} -l app.kubernetes.io/name={{ include "promtail.name" . }} -o jsonpath="{.items[0].metadata.name}") -- cat /etc/promtail/promtail.yaml

For more information, visit:
  - Promtail Documentation: https://grafana.com/docs/loki/latest/clients/promtail/
  - LogQL Query Language: https://grafana.com/docs/loki/latest/logql/
