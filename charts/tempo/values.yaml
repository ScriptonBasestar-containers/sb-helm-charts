# Default values for tempo

# Number of Tempo instances
replicaCount: 1

image:
  repository: grafana/tempo
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Tempo configuration
tempo:
  # Use an existing ConfigMap for Tempo configuration
  existingConfigMap: ""

  # Use an existing Secret for S3 credentials
  existingSecret: ""

  # Authentication configuration
  auth:
    enabled: false

  # Storage configuration
  storage:
    # Storage type: local or s3
    type: "local"

    # Local storage configuration
    local:
      path: "/var/tempo/traces"

    # S3/MinIO storage configuration (only used if type is "s3")
    s3:
      endpoint: ""  # e.g., minio.default.svc.cluster.local:9000
      bucket: "tempo-traces"
      accessKeyId: ""
      secretAccessKey: ""
      insecure: false  # Set true for HTTP (MinIO dev)

  # Trace retention
  retention:
    # Number of days to retain traces
    days: 7

  # Receiver configurations
  receivers:
    otlp:
      grpc:
        enabled: true
        port: 4317
      http:
        enabled: true
        port: 4318
    jaeger:
      grpc:
        enabled: false
        port: 14250
      thriftHttp:
        enabled: false
        port: 14268
    zipkin:
      enabled: false
      port: 9411

  # Distributor configuration
  distributor:
    receivers: []
      # - otlp

  # Ingester configuration
  ingester:
    # Trace idle time before flushing
    traceIdleTime: "10s"
    # Maximum block duration
    maxBlockDuration: "30m"

  # Compactor configuration
  compactor:
    # Compaction window
    compactionWindow: "1h"
    # Number of compaction cycles
    maxCompactionObjects: 1000000

  # Query frontend configuration
  queryFrontend:
    # Search configuration
    search:
      enabled: true
      maxDuration: "0"

  # Additional Tempo configuration
  # This will be merged with the generated config
  config: {}

  # Extra environment variables
  extraEnv: []
  # - name: CUSTOM_VAR
  #   value: "custom_value"

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 10001
  runAsUser: 10001
  runAsNonRoot: true

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false  # Tempo requires writable filesystem
  runAsNonRoot: true
  runAsUser: 10001

service:
  type: ClusterIP
  # HTTP API port
  port: 3200
  annotations: {}
  # Additional ports for receivers
  ports:
    otlpGrpc: 4317
    otlpHttp: 4318
    jaegerGrpc: 14250
    jaegerThriftHttp: 14268
    zipkin: 9411

resources:
  limits:
    cpu: 1000m
    memory: 2Gi
  requests:
    cpu: 100m
    memory: 256Mi

livenessProbe:
  httpGet:
    path: /ready
    port: 3200
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /ready
    port: 3200
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Persistence configuration (only used if storage.type is "local")
persistence:
  enabled: true
  # storageClass: "-"
  annotations: {}
  accessMode: ReadWriteOnce
  size: 10Gi

nodeSelector: {}

tolerations: []

affinity: {}

# HorizontalPodAutoscaler
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 75
  targetMemoryUtilizationPercentage: 80

# PodDisruptionBudget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# ServiceMonitor (Prometheus Operator)
serviceMonitor:
  enabled: false
  interval: 30s
  scrapeTimeout: 10s
  path: /metrics
  labels: {}
  relabelings: []
  metricRelabelings: []

# NetworkPolicy
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 3200
        - protocol: TCP
          port: 4317
        - protocol: TCP
          port: 4318
  egress:
    # Allow DNS
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: UDP
          port: 53
    # Allow S3/MinIO
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 9000
        - protocol: TCP
          port: 443
