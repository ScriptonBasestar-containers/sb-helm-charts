# Paperless-ngx values for Startup - Single Instance
# Balanced resources for small business/team use
# Use: helm install paperless-ngx ./charts/paperless-ngx -f charts/paperless-ngx/values-startup-single.yaml
#
# Requirements:
# - External PostgreSQL (required)
# - External Redis (required)
# - Set passwords: --set paperless.adminPassword=xxx --set paperless.secretKey=xxx --set postgresql.external.password=xxx

# Application configuration
paperless:
  adminUser: "admin"
  adminPassword: ""  # REQUIRED: Set via --set paperless.adminPassword=xxx
  adminEmail: "admin@example.com"
  secretKey: ""  # REQUIRED: Generate with: openssl rand -base64 32

  url: "https://paperless.example.com"
  timezone: "America/New_York"

  # OCR settings - English and Korean
  ocr:
    language: "eng+kor"  # English + Korean
    mode: "skip"  # Skip documents with existing text

  # Document processing
  consumer:
    polling: 0  # Use inotify (recommended)
    deleteSourceDocuments: true
    recursive: false
    subdirectoriesAsTags: true  # Enable for better organization

  # Email settings (optional)
  email:
    enabled: false
    host: "smtp.gmail.com"
    port: 587
    username: ""
    password: ""
    from: "paperless@example.com"
    useTLS: true
    useSSL: false

# External PostgreSQL (required)
postgresql:
  enabled: false  # NEVER auto-install
  external:
    enabled: true
    host: ""  # REQUIRED: e.g., postgres-service.default.svc.cluster.local
    port: 5432
    database: "paperless"
    username: "paperless"
    password: ""  # REQUIRED: Set via --set postgresql.external.password=xxx
    sslMode: "prefer"

# External Redis (required)
redis:
  enabled: false  # NEVER auto-install
  external:
    enabled: true
    host: ""  # REQUIRED: e.g., redis-service.default.svc.cluster.local
    port: 6379
    password: ""  # Optional
    database: 0

# Persistence - balanced storage for startup
persistence:
  enabled: true

  # Consume directory (incoming documents)
  consume:
    enabled: true
    storageClass: ""
    size: 5Gi
    accessMode: ReadWriteOnce
    existingClaim: ""
    mountPath: /usr/src/paperless/consume

  # Data directory (application data and index)
  data:
    enabled: true
    storageClass: ""
    size: 10Gi
    accessMode: ReadWriteOnce
    existingClaim: ""
    mountPath: /usr/src/paperless/data

  # Media directory (processed documents) - main storage
  media:
    enabled: true
    storageClass: ""
    size: 100Gi
    accessMode: ReadWriteOnce
    existingClaim: ""
    mountPath: /usr/src/paperless/media

  # Export directory (document exports)
  export:
    enabled: true
    storageClass: ""
    size: 10Gi
    accessMode: ReadWriteOnce
    existingClaim: ""
    mountPath: /usr/src/paperless/export

# Single instance (Paperless-ngx doesn't support horizontal scaling)
replicaCount: 1

strategy:
  type: Recreate

# Container image
image:
  repository: ghcr.io/paperless-ngx/paperless-ngx
  tag: "2.14.7"
  pullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Service account
serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels:
  environment: "startup"

# Pod security context
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000
  runAsGroup: 1000
  runAsNonRoot: true

# Container security context
securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  allowPrivilegeEscalation: false

# Service
service:
  type: ClusterIP
  port: 8000
  targetPort: 8000
  protocol: TCP
  annotations: {}

# Ingress (enabled for startup use)
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
  hosts:
    - host: paperless.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: paperless-tls
      hosts:
        - paperless.example.com

# Resource limits - BALANCED for startup
resources:
  limits:
    cpu: 1000m     # 1 CPU
    memory: 1Gi    # 1GB memory
  requests:
    cpu: 200m      # Guaranteed 200m
    memory: 512Mi  # Guaranteed 512Mi

# Health probes
livenessProbe:
  enabled: true
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

readinessProbe:
  enabled: true
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  enabled: true
  httpGet:
    path: /
    port: http
  initialDelaySeconds: 20
  periodSeconds: 5
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# Autoscaling - DISABLED (Paperless-ngx doesn't support horizontal scaling)
autoscaling:
  enabled: false

# Pod Disruption Budget - DISABLED for single instance
podDisruptionBudget:
  enabled: false

# Network Policy - DISABLED (optional for startup)
networkPolicy:
  enabled: false

# Monitoring - Optional
monitoring:
  enabled: false
  serviceMonitor:
    enabled: false
    interval: 30s
    scrapeTimeout: 10s
    labels: {}
    path: /api/metrics/

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

priorityClassName: ""
topologySpreadConstraints: []

# Additional environment variables
extraEnv:
  # Consumer and worker threads - balanced for startup
  - name: PAPERLESS_TASK_WORKERS
    value: "2"
  - name: PAPERLESS_THREADS_PER_WORKER
    value: "2"
  # Enable additional features
  - name: PAPERLESS_ENABLE_HTTP_REMOTE_USER
    value: "false"
  # Tika and Gotenberg for document processing
  - name: PAPERLESS_TIKA_ENABLED
    value: "true"
  - name: PAPERLESS_TIKA_ENDPOINT
    value: "http://localhost:9998"
  - name: PAPERLESS_TIKA_GOTENBERG_ENDPOINT
    value: "http://localhost:3000"

extraEnvFrom: []

# Additional volumes
extraVolumes: []
extraVolumeMounts: []

# Init containers - empty (configure separately if needed)
initContainers: []
# Example: Database and Redis health checks
# initContainers:
#   - name: wait-for-db
#     image: postgres:17-alpine
#     command: ["sh", "-c", "until pg_isready -h postgres.default.svc.cluster.local -p 5432; do sleep 2; done"]
#   - name: wait-for-redis
#     image: redis:8-alpine
#     command: ["sh", "-c", "until redis-cli -h redis.default.svc.cluster.local ping; do sleep 2; done"]

# Lifecycle hooks
lifecycle:
  preStop:
    exec:
      command: ["/bin/sh", "-c", "sleep 15"]
