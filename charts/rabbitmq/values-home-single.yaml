# Home Server scenario for rabbitmq
# Minimal resources for personal/home lab use
# Single replica, basic configuration

# 1. Application-specific Configuration

rabbitmq:
  admin:
    username: "guest"
    # REQUIRED: Set admin password via --set rabbitmq.admin.password=xxx
    password: ""

  # Minimal RabbitMQ configuration
  conf: |
    ## Network configuration
    listeners.tcp.default = 5672

    ## Management plugin
    management.tcp.port = 15672
    management.tcp.ip = 0.0.0.0

    ## Memory threshold (60% for home server)
    vm_memory_high_watermark.relative = 0.6

    ## Disk free space limit
    disk_free_limit.absolute = 1GB

    ## Default vhost
    default_vhost = /

    ## Logging
    log.console = true
    log.console.level = info
    log.file = false

    ## Heartbeat
    heartbeat = 60

  plugins: |
    [rabbitmq_management,rabbitmq_management_agent].

# 3. Persistence Configuration

persistence:
  enabled: true
  storageClass: ""
  accessMode: ReadWriteOnce
  size: 5Gi
  reclaimPolicy: Retain

# 4. Kubernetes Resources

replicaCount: 1

image:
  repository: rabbitmq
  tag: "3.13.1-management"
  pullPolicy: IfNotPresent

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 1

# 5. Service Account

serviceAccount:
  create: true
  automount: true

# 6. Pod Configuration

podSecurityContext:
  fsGroup: 999
  runAsUser: 999
  runAsGroup: 999
  runAsNonRoot: true

securityContext:
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 999
  runAsGroup: 999
  allowPrivilegeEscalation: false

# 7. Service Configuration

service:
  type: ClusterIP
  amqp:
    port: 5672
  management:
    port: 15672

# 9. Resources - Minimal for home server

resources:
  limits:
    cpu: 250m
    memory: 256Mi
  requests:
    cpu: 50m
    memory: 128Mi

# 10. Health Probes

livenessProbe:
  enabled: true
  exec:
    command:
      - rabbitmq-diagnostics
      - ping
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

readinessProbe:
  enabled: true
  exec:
    command:
      - rabbitmq-diagnostics
      - check_running
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

startupProbe:
  enabled: true
  exec:
    command:
      - rabbitmq-diagnostics
      - ping
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 5
  failureThreshold: 30
  successThreshold: 1

# 11. Autoscaling - Disabled

autoscaling:
  enabled: false

# 12. Pod Disruption Budget - Disabled

podDisruptionBudget:
  enabled: false

# 13. Network Policy - Disabled

networkPolicy:
  enabled: false

# 14. Monitoring - Disabled

monitoring:
  enabled: false

# 15. Scheduling

nodeSelector: {}
tolerations: []
affinity: {}
