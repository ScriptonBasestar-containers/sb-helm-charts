{{- if not .Values.mongodb.existingConfigMap }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "mongodb.configMapName" . }}
  labels:
    {{- include "mongodb.labels" . | nindent 4 }}
data:
  mongod.conf: |
    # Network settings
    net:
      port: 27017
      bindIp: 0.0.0.0

    # Storage settings
    storage:
      dbPath: /data/db
      journal:
        enabled: true
      wiredTiger:
        engineConfig:
          cacheSizeGB: {{ .Values.mongodb.wiredTiger.cacheSizeGB }}

    # Security settings
    security:
      authorization: {{ .Values.mongodb.auth.enabled | ternary "enabled" "disabled" }}

    {{- if .Values.mongodb.replicaSet.enabled }}
    # Replication settings
    replication:
      replSetName: {{ include "mongodb.replicaSetName" . }}
    {{- end }}

    # Operation profiling
    operationProfiling:
      mode: {{ .Values.mongodb.profiling.mode }}
      slowOpThresholdMs: {{ .Values.mongodb.profiling.slowOpThresholdMs }}

    # System log
    systemLog:
      destination: file
      path: /var/log/mongodb/mongod.log
      logAppend: true
      verbosity: {{ .Values.mongodb.systemLog.verbosity }}

    {{- with .Values.mongodb.config }}
    # Custom configuration
    {{- toYaml . | nindent 4 }}
    {{- end }}
{{- end }}
